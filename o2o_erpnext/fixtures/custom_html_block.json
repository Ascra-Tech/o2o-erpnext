[
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<!-- Sub-branch Info and Budget Container -->\n<div>\n    <!-- Sub-branch Info Display -->\n    <div id=\"sub_branch_info\" class=\"branch-info-container\"></div>\n\n    <!-- Sub-branch Budget Container -->\n    <div id=\"sub_budget_container\">\n        <!-- Sub-branch Capex Budget Section -->\n        <div id=\"sub_capex_section\">\n            <h5>Available Sub-branch Capex Credit Value</h5>\n            <div id=\"sub_custom_capex_budget\"></div>\n        </div>\n        \n        <!-- Sub-branch Opex Budget Section -->\n        <div id=\"sub_opex_section\">\n            <h5>Available Sub-branch Opex Credit Value</h5>\n            <div id=\"sub_custom_opex_budget\"></div>\n        </div>\n    </div>\n</div>",
  "modified": "2025-03-06 08:15:30.111553",
  "name": "Sub Branch Budget Display",
  "private": 0,
  "roles": [
   {
    "parent": "Sub Branch Budget Display",
    "parentfield": "roles",
    "parenttype": "Custom HTML Block",
    "role": "Person Raising Request"
   }
  ],
  "script": "// Script for displaying Sub-branch budget values\nfrappe.call({\n    method: \"frappe.client.get\",\n    args: {\n        doctype: \"Employee\",\n        filters: {\n            user_id: ['=', frappe.session.user]\n        },\n        fields: [\"custom_supplier\", \"custom_sub_branch\"], // Get sub-branch instead of branch\n    },\n    callback(employeeResponse) {\n        if (employeeResponse && employeeResponse.message) {\n            const employee = employeeResponse.message;\n\n            // Make sure we have a sub-branch value\n            if (!employee.custom_sub_branch) {\n                return; // Exit if no sub-branch is associated\n            }\n\n            frappe.call({\n                method: \"frappe.client.get\",\n                args: {\n                    doctype: \"Supplier\",\n                    filters: {\n                        name: employee.custom_supplier\n                    },\n                    fields: [\"custom_show_capex_budget\", \"custom_show_opex_budget\", \"supplier_name\"],\n                },\n                callback(supplierResponse) {\n                    if (supplierResponse && supplierResponse.message) {\n                        const supplier = supplierResponse.message;\n\n                        // Now fetch Sub-branch data with correct field names\n                        frappe.call({\n                            method: \"frappe.client.get\",\n                            args: {\n                                doctype: \"Sub Branch\", // Make sure spacing is exact\n                                filters: {\n                                    name: employee.custom_sub_branch\n                                },\n                                fields: [\"sub_branch_name\", \"branch\", \"capex_budget\", \"opex_budget\", \"branch_code\"],\n                            },\n                            callback(subBranchResponse) {\n                                if (subBranchResponse && subBranchResponse.message) {\n                                    const subBranch = subBranchResponse.message;\n                                    \n                                    // Get branch details to show the parent branch name\n                                    frappe.call({\n                                        method: \"frappe.client.get\",\n                                        args: {\n                                            doctype: \"Branch\",\n                                            filters: {\n                                                name: subBranch.branch\n                                            },\n                                            fields: [\"branch\"],\n                                        },\n                                        callback(branchResponse) {\n                                            const branchDetails = branchResponse && branchResponse.message ? branchResponse.message : null;\n                                            \n                                            // Add branch name, supplier display\n                                            const infoContainer = root_element.querySelector('#sub_branch_info');\n                                            if (infoContainer) {\n                                                infoContainer.innerHTML = `\n                                                    <div class=\"branch-details\">\n                                                        <span>Sub-branch: <strong>${subBranch.sub_branch_name}</strong> (Code: ${subBranch.branch_code || 'N/A'})</span>\n                                                        <span>Branch: <strong>${branchDetails ? branchDetails.branch : 'N/A'}</strong></span>\n                                                        <span>Supplier: <strong>${supplier.supplier_name || 'N/A'}</strong></span>\n                                                    </div>\n                                                `;\n                                            }\n                                            \n                                            // Handle Capex display\n                                            const capexSection = root_element.querySelector('#sub_capex_section');\n                                            const capexElement = root_element.querySelector('#sub_custom_capex_budget');\n                                            \n                                            if (supplier.custom_show_capex_budget) {\n                                                if (capexSection) capexSection.style.display = 'block';\n                                                \n                                                if (capexElement) {\n                                                    // Only add ₹ if there's a valid budget value\n                                                    if (subBranch.capex_budget && subBranch.capex_budget !== \"N/A\") {\n                                                        capexElement.textContent = \"₹ \" + subBranch.capex_budget;\n                                                    } else {\n                                                        capexElement.textContent = \"N/A\";\n                                                    }\n                                                }\n                                            } else {\n                                                if (capexSection) capexSection.style.display = 'none';\n                                            }\n                                            \n                                            // Handle Opex display\n                                            const opexSection = root_element.querySelector('#sub_opex_section');\n                                            const opexElement = root_element.querySelector('#sub_custom_opex_budget');\n                                            \n                                            if (supplier.custom_show_opex_budget) {\n                                                if (opexSection) opexSection.style.display = 'block';\n                                                \n                                                if (opexElement) {\n                                                    // Only add ₹ if there's a valid budget value\n                                                    if (subBranch.opex_budget && subBranch.opex_budget !== \"N/A\") {\n                                                        opexElement.textContent = \"₹ \" + subBranch.opex_budget;\n                                                    } else {\n                                                        opexElement.textContent = \"N/A\";\n                                                    }\n                                                }\n                                            } else {\n                                                if (opexSection) opexSection.style.display = 'none';\n                                            }\n                                            \n                                            // Make containers visible if at least one budget section is visible\n                                            if (supplier.custom_show_capex_budget || supplier.custom_show_opex_budget) {\n                                                // Show the info container\n                                                if (infoContainer) infoContainer.style.display = 'block';\n                                                \n                                                // Show the budget container\n                                                const container = root_element.querySelector('#sub_budget_container');\n                                                if (container) container.style.display = 'flex';\n                                            } else {\n                                                // Hide all containers if both budgets are hidden\n                                                const container = root_element.querySelector('#sub_budget_container');\n                                                if (container) container.style.display = 'none';\n                                                \n                                                if (infoContainer) infoContainer.style.display = 'none';\n                                            }\n                                        }\n                                    });\n                                }\n                            }\n                        });\n                    }\n                }\n            });\n        }\n    }\n});",
  "style": "/* Branch Info Display Styles */\n.branch-info-container {\n    background-color: #f9fafc;\n    padding: 12px 20px;\n    border-radius: 10px 10px 0 0;\n    margin-bottom: -10px;\n    border: 1px solid rgba(230, 235, 245, 0.8);\n    border-bottom: none;\n}\n\n.branch-details {\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: space-between;\n    gap: 10px;\n    font-size: 14px;\n    color: #4b5563;\n}\n\n.branch-details span {\n    padding: 4px 0;\n}\n\n.branch-details strong {\n    color: #1f2937;\n    font-weight: 600;\n}\n\n.branch-details .sub-branch-count {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    background: #2490ef;\n    color: white;\n    min-width: 22px;\n    height: 22px;\n    padding: 0 6px;\n    border-radius: 11px;\n    font-size: 13px;\n    text-align: center;\n    margin-left: 4px;\n}\n\n/* Modern, Premium Budget Container Styles */\n#budget_container, #sub_budget_container {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 24px;\n    margin-bottom: 30px;\n    padding: 20px;\n    background-color: #f9fafc;\n    border: 1px solid rgba(230, 235, 245, 0.8);\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);\n}\n\n/* Adjust border radius when branch info is present */\n.branch-info-container + #budget_container {\n    border-radius: 0 0 12px 12px;\n}\n\n/* Default border radius when no branch info is present */\n#budget_container {\n    border-radius: 12px;\n}\n\n#sub_budget_container {\n    border-radius: 12px;\n}\n\n/* Common styles for budget sections with glass-morphism effect */\n#capex_section, #opex_section, \n#sub_capex_section, #sub_opex_section {\n    flex: 1;\n    min-width: 260px;\n    padding: 22px;\n    border-radius: 10px;\n    background: rgba(255, 255, 255, 0.9);\n    backdrop-filter: blur(10px);\n    box-shadow: 0 8px 24px rgba(149, 157, 165, 0.1);\n    border: 1px solid rgba(255, 255, 255, 0.6);\n    transition: all 0.35s cubic-bezier(0.23, 1, 0.32, 1);\n    overflow: hidden;\n    position: relative;\n}\n\n/* Modern hover effects */\n#capex_section:hover, #opex_section:hover,\n#sub_capex_section:hover, #sub_opex_section:hover {\n    transform: translateY(-4px);\n    box-shadow: 0 14px 28px rgba(149, 157, 165, 0.15);\n}\n\n/* Add subtle background accents */\n#capex_section::after, #sub_capex_section::after {\n    content: '';\n    position: absolute;\n    top: 0;\n    right: 0;\n    width: 80px;\n    height: 80px;\n    background: radial-gradient(circle, rgba(36, 144, 239, 0.08) 0%, rgba(255, 255, 255, 0) 70%);\n    border-radius: 50%;\n    z-index: 0;\n}\n\n#opex_section::after, #sub_opex_section::after {\n    content: '';\n    position: absolute;\n    top: 0;\n    right: 0;\n    width: 80px;\n    height: 80px;\n    background: radial-gradient(circle, rgba(249, 168, 37, 0.08) 0%, rgba(255, 255, 255, 0) 70%);\n    border-radius: 50%;\n    z-index: 0;\n}\n\n/* Modern typography for section headings */\n#budget_container h5, #sub_budget_container h5 {\n    margin-top: 0;\n    font-size: 14px;\n    font-weight: 500;\n    color: #64748b;\n    margin-bottom: 16px;\n    letter-spacing: 0.3px;\n    position: relative;\n    padding-left: 0;\n    display: flex;\n    align-items: center;\n    z-index: 1;\n}\n\n/* Budget values with modern typography */\n#custom_capex_budget, #custom_opex_budget,\n#sub_custom_capex_budget, #sub_custom_opex_budget {\n    font-size: 28px;\n    font-weight: 600;\n    margin-top: 8px;\n    letter-spacing: -0.5px;\n    position: relative;\n    z-index: 1;\n}\n\n/* Capex-specific styles with colored dot instead of border */\n#capex_section h5::before, #sub_capex_section h5::before {\n    content: '';\n    display: inline-block;\n    width: 10px;\n    height: 10px;\n    background-color: #2490ef;\n    border-radius: 50%;\n    margin-right: 10px;\n}\n\n#custom_capex_budget, #sub_custom_capex_budget {\n    color: #2490ef;\n    background: linear-gradient(45deg, #2490ef, #4cacff);\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    background-clip: text;\n}\n\n/* Opex-specific styles with colored dot instead of border */\n#opex_section h5::before, #sub_opex_section h5::before {\n    content: '';\n    display: inline-block;\n    width: 10px;\n    height: 10px;\n    background-color: #f9a825;\n    border-radius: 50%;\n    margin-right: 10px;\n}\n\n#custom_opex_budget, #sub_custom_opex_budget {\n    color: #f9a825;\n    background: linear-gradient(45deg, #f9a825, #ffb74d);\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    background-clip: text;\n}\n\n/* Add a subtle separator between branch and sub-branch sections if they appear together */\n#budget_container + #sub_budget_container {\n    margin-top: 25px;\n}\n\n/* Responsive adjustments */\n@media (max-width: 991px) {\n    #budget_container, #sub_budget_container {\n        padding: 18px;\n    }\n    \n    #capex_section, #opex_section, \n    #sub_capex_section, #sub_opex_section {\n        padding: 18px;\n    }\n    \n    .branch-details {\n        flex-direction: column;\n        gap: 5px;\n    }\n}\n\n@media (max-width: 768px) {\n    #budget_container, #sub_budget_container {\n        flex-direction: column;\n    }\n    \n    #capex_section, #opex_section, \n    #sub_capex_section, #sub_opex_section {\n        min-width: 100%;\n    }\n}\n\n/* Fallback for browsers that don't support backdrop-filter */\n@supports not (backdrop-filter: blur(10px)) {\n    #capex_section, #opex_section, \n    #sub_capex_section, #sub_opex_section {\n        background: white;\n    }\n}\n\n/* Special handling for N/A values */\n#custom_capex_budget:contains(\"N/A\"), \n#custom_opex_budget:contains(\"N/A\"),\n#sub_custom_capex_budget:contains(\"N/A\"), \n#sub_custom_opex_budget:contains(\"N/A\") {\n    font-size: 20px;\n    color: #9ca3af;\n    background: none;\n    -webkit-text-fill-color: #9ca3af;\n}"
 },
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<!-- Branch Info and Budget Container -->\n<div>\n    <!-- Branch Info Display -->\n    <div id=\"branch_info\" class=\"branch-info-container\"></div>\n\n    <!-- Branch Budget Container -->\n    <div id=\"budget_container\">\n        <!-- Branch Capex Budget Section -->\n        <div id=\"capex_section\">\n            <h5>Branch Capex Budget</h5>\n            <div id=\"custom_capex_budget\"></div>\n        </div>\n        \n        <!-- Branch Opex Budget Section -->\n        <div id=\"opex_section\">\n            <h5>Branch Opex Budget</h5>\n            <div id=\"custom_opex_budget\"></div>\n        </div>\n    </div>\n</div>",
  "modified": "2025-03-06 08:05:14.373958",
  "name": "Branch Budget Display for PRR Branch",
  "private": 0,
  "roles": [
   {
    "parent": "Branch Budget Display for PRR Branch",
    "parentfield": "roles",
    "parenttype": "Custom HTML Block",
    "role": "Person Raising Request Branch"
   }
  ],
  "script": "// Author : Amit Kumar\nfrappe.call({\n    method: \"frappe.client.get\",\n    args: {\n        doctype: \"Employee\",\n        filters: {\n            user_id: ['=', frappe.session.user]\n        },\n        fields: [\"custom_supplier\", \"branch\"],\n    },\n    callback(employeeResponse) {\n        if (employeeResponse && employeeResponse.message) {\n            const employee = employeeResponse.message;\n            \n            // Exit if branch is missing\n            if (!employee.branch) {\n                return;\n            }\n            \n            frappe.call({\n                method: \"frappe.client.get\",\n                args: {\n                    doctype: \"Supplier\",\n                    filters: {\n                        name: employee.custom_supplier\n                    },\n                    fields: [\"custom_show_capex_budget\", \"custom_show_opex_budget\", \"supplier_name\"],\n                },\n                callback(supplierResponse) {\n                    if (supplierResponse && supplierResponse.message) {\n                        const supplier = supplierResponse.message;\n                        \n                        frappe.call({\n                            method: \"frappe.client.get\",\n                            args: {\n                                doctype: \"Branch\",\n                                filters: {\n                                    name: employee.branch\n                                },\n                                fields: [\"branch\", \"custom_capex_budget\", \"custom_opex_budget\", \"custom_branch_code\", \"custom_supplier\"],\n                            },\n                            callback(branchResponse) {\n                                if (branchResponse && branchResponse.message) {\n                                    const branch = branchResponse.message;\n                                    \n                                    // Count sub-branches linked to this branch\n                                    frappe.call({\n                                        method: \"frappe.client.get_list\",\n                                        args: {\n                                            doctype: \"Sub Branch\",\n                                            filters: {\n                                                branch: employee.branch\n                                            },\n                                            fields: [\"name\"],\n                                        },\n                                        callback(subBranchResponse) {\n                                            // Handle Capex display\n                                            const capexSection = root_element.querySelector('#capex_section');\n                                            const capexElement = root_element.querySelector('#custom_capex_budget');\n                                            \n                                            if (supplier.custom_show_capex_budget) {\n                                                if (capexSection) capexSection.style.display = 'block';\n                                                if (capexElement) {\n                                                    // Check if value exists before formatting\n                                                    const capexValue = branch.custom_capex_budget;\n                                                    if (capexValue && capexValue !== \"N/A\") {\n                                                        capexElement.textContent = \"₹ \" + capexValue;\n                                                    } else {\n                                                        capexElement.textContent = \"N/A\";\n                                                    }\n                                                }\n                                            } else {\n                                                if (capexSection) capexSection.style.display = 'none';\n                                            }\n                                            \n                                            // Handle Opex display\n                                            const opexSection = root_element.querySelector('#opex_section');\n                                            const opexElement = root_element.querySelector('#custom_opex_budget');\n                                            \n                                            if (supplier.custom_show_opex_budget) {\n                                                if (opexSection) opexSection.style.display = 'block';\n                                                if (opexElement) {\n                                                    // Check if value exists before formatting\n                                                    const opexValue = branch.custom_opex_budget;\n                                                    if (opexValue && opexValue !== \"N/A\") {\n                                                        opexElement.textContent = \"₹ \" + opexValue;\n                                                    } else {\n                                                        opexElement.textContent = \"N/A\";\n                                                    }\n                                                }\n                                            } else {\n                                                if (opexSection) opexSection.style.display = 'none';\n                                            }\n                                            \n                                            // Only if both budget displays should be visible, then add branch info\n                                            if (supplier.custom_show_capex_budget || supplier.custom_show_opex_budget) {\n                                                // Get sub-branch count\n                                                const subBranchCount = subBranchResponse && subBranchResponse.message ? subBranchResponse.message.length : 0;\n                                                \n                                                // Add branch name, supplier display and sub-branch count\n                                                const infoContainer = root_element.querySelector('#branch_info');\n                                                if (infoContainer) {\n                                                    infoContainer.innerHTML = `\n                                                        <div class=\"branch-details\">\n                                                            <span>Branch: <strong>${branch.branch}</strong> (Code: ${branch.custom_branch_code || 'N/A'})</span>\n                                                            <span>Supplier: <strong>${supplier.supplier_name || branch.custom_supplier || 'N/A'}</strong></span>\n                                                            <span>Sub-branches: <strong class=\"sub-branch-count\">${subBranchCount}</strong></span>\n                                                        </div>\n                                                    `;\n                                                }\n                                                \n                                                // Make branch info container visible\n                                                if (infoContainer) infoContainer.style.display = 'block';\n                                                \n                                                // Make budget container visible\n                                                const container = root_element.querySelector('#budget_container');\n                                                if (container) container.style.display = 'flex';\n                                            } else {\n                                                // Hide entire container if both budgets are hidden\n                                                const container = root_element.querySelector('#budget_container');\n                                                if (container) container.style.display = 'none';\n                                                \n                                                // Also hide the branch info\n                                                const infoContainer = root_element.querySelector('#branch_info');\n                                                if (infoContainer) infoContainer.style.display = 'none';\n                                            }\n                                        }\n                                    });\n                                }\n                            }\n                        });\n                    }\n                }\n            });\n        }\n    }\n});",
  "style": "/* Branch Info Display Styles */\n.branch-info-container {\n    background-color: #f9fafc;\n    padding: 12px 20px;\n    border-radius: 10px 10px 0 0;\n    margin-bottom: -10px;\n    border: 1px solid rgba(230, 235, 245, 0.8);\n    border-bottom: none;\n}\n\n.branch-details {\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: space-between;\n    gap: 10px;\n    font-size: 14px;\n    color: #4b5563;\n}\n\n.branch-details span {\n    padding: 4px 0;\n}\n\n.branch-details strong {\n    color: #1f2937;\n    font-weight: 600;\n}\n\n.branch-details .sub-branch-count {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    background: #2490ef;\n    color: white;\n    min-width: 22px;\n    height: 22px;\n    padding: 0 6px;\n    border-radius: 11px;\n    font-size: 13px;\n    text-align: center;\n    margin-left: 4px;\n}\n\n/* Modern, Premium Budget Container Styles */\n#budget_container, #sub_budget_container {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 24px;\n    margin-bottom: 30px;\n    padding: 20px;\n    background-color: #f9fafc;\n    border: 1px solid rgba(230, 235, 245, 0.8);\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);\n}\n\n/* Adjust border radius when branch info is present */\n.branch-info-container + #budget_container {\n    border-radius: 0 0 12px 12px;\n}\n\n/* Default border radius when no branch info is present */\n#budget_container {\n    border-radius: 12px;\n}\n\n#sub_budget_container {\n    border-radius: 12px;\n}\n\n/* Common styles for budget sections with glass-morphism effect */\n#capex_section, #opex_section, \n#sub_capex_section, #sub_opex_section {\n    flex: 1;\n    min-width: 260px;\n    padding: 22px;\n    border-radius: 10px;\n    background: rgba(255, 255, 255, 0.9);\n    backdrop-filter: blur(10px);\n    box-shadow: 0 8px 24px rgba(149, 157, 165, 0.1);\n    border: 1px solid rgba(255, 255, 255, 0.6);\n    transition: all 0.35s cubic-bezier(0.23, 1, 0.32, 1);\n    overflow: hidden;\n    position: relative;\n}\n\n/* Modern hover effects */\n#capex_section:hover, #opex_section:hover,\n#sub_capex_section:hover, #sub_opex_section:hover {\n    transform: translateY(-4px);\n    box-shadow: 0 14px 28px rgba(149, 157, 165, 0.15);\n}\n\n/* Add subtle background accents */\n#capex_section::after, #sub_capex_section::after {\n    content: '';\n    position: absolute;\n    top: 0;\n    right: 0;\n    width: 80px;\n    height: 80px;\n    background: radial-gradient(circle, rgba(36, 144, 239, 0.08) 0%, rgba(255, 255, 255, 0) 70%);\n    border-radius: 50%;\n    z-index: 0;\n}\n\n#opex_section::after, #sub_opex_section::after {\n    content: '';\n    position: absolute;\n    top: 0;\n    right: 0;\n    width: 80px;\n    height: 80px;\n    background: radial-gradient(circle, rgba(249, 168, 37, 0.08) 0%, rgba(255, 255, 255, 0) 70%);\n    border-radius: 50%;\n    z-index: 0;\n}\n\n/* Modern typography for section headings */\n#budget_container h5, #sub_budget_container h5 {\n    margin-top: 0;\n    font-size: 14px;\n    font-weight: 500;\n    color: #64748b;\n    margin-bottom: 16px;\n    letter-spacing: 0.3px;\n    position: relative;\n    padding-left: 0;\n    display: flex;\n    align-items: center;\n    z-index: 1;\n}\n\n/* Budget values with modern typography */\n#custom_capex_budget, #custom_opex_budget,\n#sub_custom_capex_budget, #sub_custom_opex_budget {\n    font-size: 28px;\n    font-weight: 600;\n    margin-top: 8px;\n    letter-spacing: -0.5px;\n    position: relative;\n    z-index: 1;\n}\n\n/* Capex-specific styles with colored dot instead of border */\n#capex_section h5::before, #sub_capex_section h5::before {\n    content: '';\n    display: inline-block;\n    width: 10px;\n    height: 10px;\n    background-color: #2490ef;\n    border-radius: 50%;\n    margin-right: 10px;\n}\n\n#custom_capex_budget, #sub_custom_capex_budget {\n    color: #2490ef;\n    background: linear-gradient(45deg, #2490ef, #4cacff);\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    background-clip: text;\n}\n\n/* Opex-specific styles with colored dot instead of border */\n#opex_section h5::before, #sub_opex_section h5::before {\n    content: '';\n    display: inline-block;\n    width: 10px;\n    height: 10px;\n    background-color: #f9a825;\n    border-radius: 50%;\n    margin-right: 10px;\n}\n\n#custom_opex_budget, #sub_custom_opex_budget {\n    color: #f9a825;\n    background: linear-gradient(45deg, #f9a825, #ffb74d);\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    background-clip: text;\n}\n\n/* Add a subtle separator between branch and sub-branch sections if they appear together */\n#budget_container + #sub_budget_container {\n    margin-top: 25px;\n}\n\n/* Responsive adjustments */\n@media (max-width: 991px) {\n    #budget_container, #sub_budget_container {\n        padding: 18px;\n    }\n    \n    #capex_section, #opex_section, \n    #sub_capex_section, #sub_opex_section {\n        padding: 18px;\n    }\n    \n    .branch-details {\n        flex-direction: column;\n        gap: 5px;\n    }\n}\n\n@media (max-width: 768px) {\n    #budget_container, #sub_budget_container {\n        flex-direction: column;\n    }\n    \n    #capex_section, #opex_section, \n    #sub_capex_section, #sub_opex_section {\n        min-width: 100%;\n    }\n}\n\n/* Fallback for browsers that don't support backdrop-filter */\n@supports not (backdrop-filter: blur(10px)) {\n    #capex_section, #opex_section, \n    #sub_capex_section, #sub_opex_section {\n        background: white;\n    }\n}\n\n/* Special handling for N/A values */\n#custom_capex_budget:contains(\"N/A\"), \n#custom_opex_budget:contains(\"N/A\"),\n#sub_custom_capex_budget:contains(\"N/A\"), \n#sub_custom_opex_budget:contains(\"N/A\") {\n    font-size: 20px;\n    color: #9ca3af;\n    background: none;\n    -webkit-text-fill-color: #9ca3af;\n}"
 },
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<!-- Supplier Info and Budget Container -->\n<div>\n    <!-- Supplier Info Display -->\n    <div id=\"supplier_info\" class=\"supplier-info-container\"></div>\n\n    <!-- Supplier Budget Container -->\n    <div id=\"supplier_budget_container\">\n        <!-- Supplier Capex Budget Section -->\n        <div id=\"supplier_capex_section\">\n            <h5>Entity Capex Budget</h5>\n            <div id=\"supplier_custom_capex_budget\"></div>\n        </div>\n        \n        <!-- Supplier Opex Budget Section -->\n        <div id=\"supplier_opex_section\">\n            <h5>Entity Opex Budget</h5>\n            <div id=\"supplier_custom_opex_budget\"></div>\n        </div>\n    </div>\n</div>",
  "modified": "2025-03-06 09:26:39.193327",
  "name": "Supplier Workspace Block",
  "private": 0,
  "roles": [
   {
    "parent": "Supplier Workspace Block",
    "parentfield": "roles",
    "parenttype": "Custom HTML Block",
    "role": "Supplier"
   }
  ],
  "script": "// Script for displaying Supplier information and budget values - Simplified version\n// First get the logged in user's ID\nconst currentUser = frappe.session.user;\n\n// Store sub-branches globally to avoid scope issues\nlet globalSubBranches = [];\n\n// Directly find the supplier linked to the logged in user via custom_user field\nfrappe.call({\n    method: \"frappe.client.get_list\",\n    args: {\n        doctype: \"Supplier\",\n        filters: {\n            custom_user: currentUser\n        },\n        fields: [\"name\"]\n    },\n    callback(supplierListResponse) {\n        if (supplierListResponse && supplierListResponse.message && supplierListResponse.message.length > 0) {\n            // Get the first matched supplier (assuming one user is linked to one supplier)\n            const supplierName = supplierListResponse.message[0].name;\n            \n            // Now fetch the full supplier details\n            frappe.call({\n                method: \"frappe.client.get\",\n                args: {\n                    doctype: \"Supplier\",\n                    name: supplierName,\n                    fields: [\n                        \"supplier_name\", \n                        \"custom_entity_code\", \n                        \"custom_entity_type\",\n                        \"custom_capex_budget\", \n                        \"custom_opex_budget\",\n                        \"custom_minimum_order_value\",\n                        \"custom_maximum_order_value\",\n                        \"country\",\n                        \"default_currency\",\n                        \"website\",\n                        \"custom_budget_start_date\",\n                        \"custom_budget_end_date\",\n                        \"custom_financial_start_date\",\n                        \"custom_financial_end_date\",\n                        \"custom_branch\"\n                    ]\n                },\n                callback(supplierResponse) {\n                    if (supplierResponse && supplierResponse.message) {\n                        const supplier = supplierResponse.message;\n                        \n                        // If branch is linked, get branch details\n                        if (supplier.custom_branch) {\n                            frappe.call({\n                                method: \"frappe.client.get\",\n                                args: {\n                                    doctype: \"Branch\",\n                                    name: supplier.custom_branch,\n                                    fields: [\"branch\", \"custom_branch_code\"]\n                                },\n                                callback(branchResponse) {\n                                    // Count sub-branches linked to this branch\n                                    if (branchResponse && branchResponse.message) {\n                                        frappe.call({\n                                            method: \"frappe.client.get_list\",\n                                            args: {\n                                                doctype: \"Sub Branch\",\n                                                filters: {\n                                                    branch: supplier.custom_branch\n                                                },\n                                                fields: [\"name\", \"sub_branch_name\", \"branch_code\", \"capex_budget\", \"opex_budget\"]\n                                            },\n                                            callback(subBranchResponse) {\n                                                const subBranches = subBranchResponse && subBranchResponse.message ? \n                                                                  subBranchResponse.message : [];\n                                                const subBranchCount = subBranches.length;\n                                                \n                                                // Store sub-branches globally\n                                                globalSubBranches = subBranches;\n                                                \n                                                // Display the info\n                                                displaySupplierInfo(supplier, branchResponse.message, subBranchCount);\n                                            }\n                                        });\n                                    } else {\n                                        displaySupplierInfo(supplier, null, 0);\n                                    }\n                                }\n                            });\n                        } else {\n                            displaySupplierInfo(supplier, null, 0);\n                        }\n                    }\n                }\n            });\n        } else {\n            // Set default \"No data found\" message\n            const infoContainer = root_element.querySelector('#supplier_info');\n            if (infoContainer) {\n                infoContainer.innerHTML = `\n                    <div class=\"supplier-details\">\n                        <div class=\"supplier-header\">\n                            <span class=\"supplier-name\">No supplier data found</span>\n                        </div>\n                        <div class=\"supplier-info-grid\">\n                            <div class=\"info-group\">\n                                <div class=\"info-item\">\n                                    <span class=\"info-value\">No supplier is linked to your user account. Please contact your administrator.</span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                `;\n                infoContainer.style.display = 'block';\n            }\n            \n            // Hide budget container as no data is available\n            const budgetContainer = root_element.querySelector('#supplier_budget_container');\n            if (budgetContainer) budgetContainer.style.display = 'none';\n        }\n    }\n});\n\n// Function to display supplier info with branch details and sub-branch count\nfunction displaySupplierInfo(supplier, branchDetails, subBranchCount = 0) {\n    // Add supplier information display\n    const infoContainer = root_element.querySelector('#supplier_info');\n    \n    if (infoContainer) {\n        // Format dates for display\n        const formatDate = (dateStr) => {\n            if (!dateStr) return 'N/A';\n            try {\n                const date = new Date(dateStr);\n                return date.toLocaleDateString('en-IN');\n            } catch (e) {\n                return dateStr;\n            }\n        };\n        \n        const financialStartDate = formatDate(supplier.custom_financial_start_date);\n        const financialEndDate = formatDate(supplier.custom_financial_end_date);\n        \n        // Prepare branch display info\n        let branchInfo = 'N/A';\n        if (branchDetails) {\n            branchInfo = `${branchDetails.branch}`;\n            if (branchDetails.custom_branch_code) {\n                branchInfo += ` (Code: ${branchDetails.custom_branch_code})`;\n            }\n            // Add sub-branch count if branch exists\n            if (subBranchCount > 0) {\n                // Direct onclick attribute for Frappe compatibility\n                branchInfo += ` <span class=\"sub-branch-count\" onclick=\"showSubBranchDialog()\">${subBranchCount}</span>`;\n            } else {\n                branchInfo += ` <span class=\"sub-branch-count-zero\">0</span>`;\n            }\n        }\n        \n        infoContainer.innerHTML = `\n            <div class=\"supplier-details\">\n                <div class=\"supplier-header\">\n                    <span class=\"supplier-name\">${supplier.supplier_name || 'N/A'}</span>\n                    <span class=\"supplier-code\">(Code: ${supplier.custom_entity_code || 'N/A'})</span>\n                </div>\n                <div class=\"supplier-info-grid\">\n                    <div class=\"info-group\">\n                        <div class=\"info-item\">\n                            <span class=\"info-label\">Entity Type:</span>\n                            <span class=\"info-value\">${supplier.custom_entity_type || 'N/A'}</span>\n                        </div>\n                        <div class=\"info-item\">\n                            <span class=\"info-label\">Branch:</span>\n                            <span class=\"info-value\">${branchInfo}</span>\n                        </div>\n                        <div class=\"info-item\">\n                            <span class=\"info-label\">Country:</span>\n                            <span class=\"info-value\">${supplier.country || 'N/A'}</span>\n                        </div>\n                    </div>\n                    <div class=\"info-group\">\n                        <div class=\"info-item\">\n                            <span class=\"info-label\">Website:</span>\n                            <span class=\"info-value\">${supplier.website || 'N/A'}</span>\n                        </div>\n                        <div class=\"info-item\">\n                            <span class=\"info-label\">Currency:</span>\n                            <span class=\"info-value\">${supplier.default_currency || 'N/A'}</span>\n                        </div>\n                        <div class=\"info-item\">\n                            <span class=\"info-label\">Min Order:</span>\n                            <span class=\"info-value\">${supplier.custom_minimum_order_value ? \"₹ \" + supplier.custom_minimum_order_value : 'N/A'}</span>\n                        </div>\n                    </div>\n                    <div class=\"info-group\">\n                        <div class=\"info-item\">\n                            <span class=\"info-label\">Max Order:</span>\n                            <span class=\"info-value\">${supplier.custom_maximum_order_value ? \"₹ \" + supplier.custom_maximum_order_value : 'N/A'}</span>\n                        </div>\n                        <div class=\"info-item\">\n                            <span class=\"info-label\">Budget Period:</span>\n                            <span class=\"info-value\">${supplier.custom_budget_start_date || 'N/A'} - ${supplier.custom_budget_end_date || 'N/A'}</span>\n                        </div>\n                        <div class=\"info-item\">\n                            <span class=\"info-label\">Financial Period:</span>\n                            <span class=\"info-value\">${financialStartDate} - ${financialEndDate}</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        \n        // Always show the info container\n        infoContainer.style.display = 'block';\n    }\n    \n    // Handle Capex display - always show it\n    const capexSection = root_element.querySelector('#supplier_capex_section');\n    const capexElement = root_element.querySelector('#supplier_custom_capex_budget');\n    \n    if (capexSection) capexSection.style.display = 'block';\n    if (capexElement) {\n        const capexValue = supplier.custom_capex_budget;\n        if (capexValue && capexValue !== \"N/A\") {\n            capexElement.textContent = \"₹ \" + capexValue;\n        } else {\n            capexElement.textContent = \"N/A\";\n        }\n    }\n    \n    // Handle Opex display - always show it\n    const opexSection = root_element.querySelector('#supplier_opex_section');\n    const opexElement = root_element.querySelector('#supplier_custom_opex_budget');\n    \n    if (opexSection) opexSection.style.display = 'block';\n    if (opexElement) {\n        const opexValue = supplier.custom_opex_budget;\n        if (opexValue && opexValue !== \"N/A\") {\n            opexElement.textContent = \"₹ \" + opexValue;\n        } else {\n            opexElement.textContent = \"N/A\";\n        }\n    }\n    \n    // Always show the budget container\n    const budgetContainer = root_element.querySelector('#supplier_budget_container');\n    if (budgetContainer) budgetContainer.style.display = 'flex';\n}\n\n// Define this function in global scope so it's accessible from inline onclick\nwindow.showSubBranchDialog = function() {\n    // Get sub-branches from global variable\n    const subBranches = globalSubBranches;\n    \n    // Create a fields array for the dialog\n    const fields = [\n        {\n            fieldtype: 'HTML',\n            fieldname: 'sub_branches_html',\n            options: `\n                <div style=\"max-height: 400px; overflow-y: auto;\">\n                    <table class=\"table table-bordered\">\n                        <thead>\n                            <tr>\n                                <th>Name</th>\n                                <th>Code</th>\n                                <th>Capex Budget</th>\n                                <th>Opex Budget</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            ${subBranches.map(sb => `\n                                <tr>\n                                    <td>${sb.sub_branch_name || sb.name || 'N/A'}</td>\n                                    <td>${sb.branch_code || 'N/A'}</td>\n                                    <td>${sb.capex_budget ? \"₹ \" + sb.capex_budget : 'N/A'}</td>\n                                    <td>${sb.opex_budget ? \"₹ \" + sb.opex_budget : 'N/A'}</td>\n                                </tr>\n                            `).join('')}\n                        </tbody>\n                    </table>\n                </div>\n            `\n        }\n    ];\n    \n    // Create and show the dialog\n    const dialog = new frappe.ui.Dialog({\n        title: `Sub-branches (${subBranches.length})`,\n        fields: fields,\n        size: 'large', // 'small', 'large'\n        primary_action_label: 'Close',\n        primary_action: () => {\n            dialog.hide();\n        }\n    });\n    \n    dialog.show();\n};",
  "style": "/* Supplier Info Display Styles - Simplified for Frappe compatibility */\n.supplier-info-container {\n    background-color: #f9fafc;\n    padding: 16px 20px;\n    border-radius: 10px 10px 0 0;\n    margin-bottom: -10px;\n    border: 1px solid rgba(230, 235, 245, 0.8);\n    border-bottom: none;\n}\n\n.supplier-details {\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n}\n\n.supplier-header {\n    display: flex;\n    align-items: baseline;\n    flex-wrap: wrap;\n    gap: 8px;\n    margin-bottom: 5px;\n}\n\n.supplier-name {\n    font-size: 18px;\n    font-weight: 600;\n    color: #1f2937;\n}\n\n.supplier-code {\n    font-size: 14px;\n    color: #6b7280;\n}\n\n.supplier-info-grid {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 24px;\n}\n\n.info-group {\n    flex: 1;\n    min-width: 200px;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.info-item {\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n\n.info-label {\n    font-size: 12px;\n    color: #6b7280;\n}\n\n.info-value {\n    font-size: 14px;\n    font-weight: 500;\n    color: #1f2937;\n}\n\n/* Sub-branch count badge */\n.sub-branch-count {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    background: #2490ef;\n    color: white;\n    min-width: 22px;\n    height: 22px;\n    padding: 0 6px;\n    border-radius: 11px;\n    font-size: 13px;\n    text-align: center;\n    margin-left: 6px;\n    vertical-align: middle;\n}\n\n.sub-branch-count:hover {\n    background: #1a7ad4;\n}\n\n.sub-branch-count-zero {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    background: #94a3b8;\n    color: white;\n    min-width: 22px;\n    height: 22px;\n    padding: 0 6px;\n    border-radius: 11px;\n    font-size: 13px;\n    text-align: center;\n    margin-left: 6px;\n    vertical-align: middle;\n}\n\n/* Supplier Budget Container Styles */\n#supplier_budget_container {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 24px;\n    margin-bottom: 30px;\n    padding: 20px;\n    background-color: #f9fafc;\n    border: 1px solid rgba(230, 235, 245, 0.8);\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);\n}\n\n/* Adjust border radius when supplier info is present */\n.supplier-info-container + #supplier_budget_container {\n    border-radius: 0 0 12px 12px;\n}\n\n/* Default border radius when no supplier info is present */\n#supplier_budget_container {\n    border-radius: 12px;\n}\n\n/* Common styles for budget sections with glass-morphism effect */\n#supplier_capex_section, #supplier_opex_section {\n    flex: 1;\n    min-width: 260px;\n    padding: 22px;\n    border-radius: 10px;\n    background: rgba(255, 255, 255, 0.9);\n    box-shadow: 0 4px 12px rgba(149, 157, 165, 0.1);\n    border: 1px solid rgba(255, 255, 255, 0.6);\n    transition: all 0.3s ease;\n    position: relative;\n}\n\n/* Modern hover effects */\n#supplier_capex_section:hover, #supplier_opex_section:hover {\n    transform: translateY(-4px);\n    box-shadow: 0 8px 16px rgba(149, 157, 165, 0.15);\n}\n\n/* Modern typography for section headings */\n#supplier_budget_container h5 {\n    margin-top: 0;\n    font-size: 14px;\n    font-weight: 500;\n    color: #64748b;\n    margin-bottom: 16px;\n    letter-spacing: 0.3px;\n    position: relative;\n    padding-left: 0;\n    display: flex;\n    align-items: center;\n}\n\n/* Budget values with modern typography */\n#supplier_custom_capex_budget, #supplier_custom_opex_budget {\n    font-size: 28px;\n    font-weight: 600;\n    margin-top: 8px;\n    letter-spacing: -0.5px;\n    position: relative;\n}\n\n/* Capex-specific styles with colored dot instead of border */\n#supplier_capex_section h5::before {\n    content: '';\n    display: inline-block;\n    width: 10px;\n    height: 10px;\n    background-color: #2490ef;\n    border-radius: 50%;\n    margin-right: 10px;\n}\n\n#supplier_custom_capex_budget {\n    color: #2490ef;\n}\n\n/* Opex-specific styles with colored dot instead of border */\n#supplier_opex_section h5::before {\n    content: '';\n    display: inline-block;\n    width: 10px;\n    height: 10px;\n    background-color: #f9a825;\n    border-radius: 50%;\n    margin-right: 10px;\n}\n\n#supplier_custom_opex_budget {\n    color: #f9a825;\n}\n\n/* Responsive adjustments */\n@media (max-width: 991px) {\n    #supplier_budget_container {\n        padding: 18px;\n    }\n    \n    #supplier_capex_section, #supplier_opex_section {\n        padding: 18px;\n    }\n    \n    .supplier-info-grid {\n        flex-direction: column;\n        gap: 15px;\n    }\n}\n\n@media (max-width: 768px) {\n    #supplier_budget_container {\n        flex-direction: column;\n    }\n    \n    #supplier_capex_section, #supplier_opex_section {\n        min-width: 100%;\n    }\n    \n    .supplier-header {\n        flex-direction: column;\n        align-items: flex-start;\n    }\n}"
 }
]