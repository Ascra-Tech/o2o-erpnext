[
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<div id=\"sub_budget_container\">\n    <!-- Sub-branch Capex Budget Section -->\n    <div id=\"sub_capex_section\">\n        <h5 style=\"color:Tomato;\">Available Sub-branch Capex Credit Value:</h5>\n        <div style=\"color:Tomato;\" id=\"sub_custom_capex_budget\"></div>\n    </div>\n    \n    <!-- Sub-branch Opex Budget Section -->\n    <div id=\"sub_opex_section\">\n        <h5 style=\"color:Tomato;\">Available Sub-branch Opex Credit Value:</h5>\n        <div style=\"color:Tomato;\" id=\"sub_custom_opex_budget\"></div>\n    </div>\n</div>",
  "modified": "2025-03-04 12:05:57.835028",
  "name": "Sub Branch Budget Display",
  "private": 0,
  "roles": [
   {
    "parent": "Sub Branch Budget Display",
    "parentfield": "roles",
    "parenttype": "Custom HTML Block",
    "role": "Person Raising Request"
   }
  ],
  "script": "// Script for displaying Sub-branch budget values\nfrappe.call({\n    method: \"frappe.client.get\",\n    args: {\n        doctype: \"Employee\",\n        filters: {\n            user_id: ['=', frappe.session.user]\n        },\n        fields: [\"custom_supplier\", \"custom_sub_branch\"], // Get sub-branch instead of branch\n    },\n    callback(employeeResponse) {\n        if (employeeResponse && employeeResponse.message) {\n            const employee = employeeResponse.message;\n\n            // Make sure we have a sub-branch value\n            if (!employee.custom_sub_branch) {\n                return; // Exit if no sub-branch is associated\n            }\n\n            frappe.call({\n                method: \"frappe.client.get\",\n                args: {\n                    doctype: \"Supplier\",\n                    filters: {\n                        name: employee.custom_supplier\n                    },\n                    fields: [\"custom_show_capex_budget\", \"custom_show_opex_budget\"],\n                },\n                callback(supplierResponse) {\n                    if (supplierResponse && supplierResponse.message) {\n                        const supplier = supplierResponse.message;\n\n                        // Now fetch Sub-branch data with correct field names\n                        frappe.call({\n                            method: \"frappe.client.get\",\n                            args: {\n                                doctype: \"Sub Branch\", // Make sure spacing is exact\n                                filters: {\n                                    name: employee.custom_sub_branch\n                                },\n                                fields: [\"capex_budget\", \"opex_budget\"], // Correct field names without \"custom_\" prefix\n                            },\n                            callback(subBranchResponse) {\n                                if (subBranchResponse && subBranchResponse.message) {\n                                    const subBranch = subBranchResponse.message;\n                                    \n                                    // Handle Capex display\n                                    const capexSection = root_element.querySelector('#sub_capex_section');\n                                    const capexElement = root_element.querySelector('#sub_custom_capex_budget');\n                                    \n                                    if (supplier.custom_show_capex_budget) {\n                                        if (capexSection) capexSection.style.display = 'block';\n                                        if (capexElement) capexElement.textContent = subBranch.capex_budget || \"N/A\";\n                                    } else {\n                                        if (capexSection) capexSection.style.display = 'none';\n                                    }\n                                    \n                                    // Handle Opex display\n                                    const opexSection = root_element.querySelector('#sub_opex_section');\n                                    const opexElement = root_element.querySelector('#sub_custom_opex_budget');\n                                    \n                                    if (supplier.custom_show_opex_budget) {\n                                        if (opexSection) opexSection.style.display = 'block';\n                                        if (opexElement) opexElement.textContent = subBranch.opex_budget || \"N/A\";\n                                    } else {\n                                        if (opexSection) opexSection.style.display = 'none';\n                                    }\n                                    \n                                    // Hide entire container if both budgets are hidden\n                                    if (!supplier.custom_show_capex_budget && !supplier.custom_show_opex_budget) {\n                                        const container = root_element.querySelector('#sub_budget_container');\n                                        if (container) container.style.display = 'none';\n                                    }\n                                }\n                            }\n                        });\n                    }\n                }\n            });\n        }\n    }\n});",
  "style": null
 },
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<div id=\"budget_container\">\n    <!-- Capex Budget Section -->\n    <div id=\"capex_section\">\n        <h5 style=\"color:Tomato;\">Branch Capex Budget:</h5>\n        <div style=\"color:Tomato;\" id=\"custom_capex_budget\"></div>\n    </div>\n    \n    <!-- Opex Budget Section -->\n    <div id=\"opex_section\">\n        <h5 style=\"color:Tomato;\">Branch Opex Budget:</h5>\n        <div style=\"color:Tomato;\" id=\"custom_opex_budget\"></div>\n    </div>\n</div>",
  "modified": "2025-03-04 11:29:14.126239",
  "name": "Branch Budget Display for PRR Branch",
  "private": 0,
  "roles": [
   {
    "parent": "Branch Budget Display for PRR Branch",
    "parentfield": "roles",
    "parenttype": "Custom HTML Block",
    "role": "Person Raising Request Branch"
   }
  ],
  "script": "// Author : Amit Kumar\nfrappe.call({\n    method: \"frappe.client.get\",\n    args: {\n        doctype: \"Employee\",\n        filters: {\n            user_id: ['=', frappe.session.user]\n        },\n        fields: [\"custom_supplier\", \"branch\"],\n    },\n    callback(employeeResponse) {\n        if (employeeResponse && employeeResponse.message) {\n            const employee = employeeResponse.message;\n\n            frappe.call({\n                method: \"frappe.client.get\",\n                args: {\n                    doctype: \"Supplier\",\n                    filters: {\n                        name: employee.custom_supplier\n                    },\n                    fields: [\"custom_show_capex_budget\", \"custom_show_opex_budget\"],\n                },\n                callback(supplierResponse) {\n                    if (supplierResponse && supplierResponse.message) {\n                        const supplier = supplierResponse.message;\n\n                        frappe.call({\n                            method: \"frappe.client.get\",\n                            args: {\n                                doctype: \"Branch\",\n                                filters: {\n                                    name: employee.branch\n                                },\n                                fields: [\"custom_capex_budget\", \"custom_opex_budget\"],\n                            },\n                            callback(branchResponse) {\n                                if (branchResponse && branchResponse.message) {\n                                    const branch = branchResponse.message;\n                                    \n                                    // Handle Capex display\n                                    const capexSection = root_element.querySelector('#capex_section');\n                                    const capexElement = root_element.querySelector('#custom_capex_budget');\n                                    \n                                    if (supplier.custom_show_capex_budget) {\n                                        if (capexSection) capexSection.style.display = 'block';\n                                        if (capexElement) capexElement.textContent = branch.custom_capex_budget || \"N/A\";\n                                    } else {\n                                        if (capexSection) capexSection.style.display = 'none';\n                                    }\n                                    \n                                    // Handle Opex display\n                                    const opexSection = root_element.querySelector('#opex_section');\n                                    const opexElement = root_element.querySelector('#custom_opex_budget');\n                                    \n                                    if (supplier.custom_show_opex_budget) {\n                                        if (opexSection) opexSection.style.display = 'block';\n                                        if (opexElement) opexElement.textContent = branch.custom_opex_budget || \"N/A\";\n                                    } else {\n                                        if (opexSection) opexSection.style.display = 'none';\n                                    }\n                                    \n                                    // Hide entire container if both budgets are hidden\n                                    if (!supplier.custom_show_capex_budget && !supplier.custom_show_opex_budget) {\n                                        const container = root_element.querySelector('#budget_container');\n                                        if (container) container.style.display = 'none';\n                                    }\n                                }\n                            }\n                        });\n                    }\n                }\n            });\n        }\n    }\n});",
  "style": null
 }
]